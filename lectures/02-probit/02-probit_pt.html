<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Econometria III</title>
    <meta charset="utf-8" />
    <meta name="author" content="Rafael Bressan" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/5235085b15.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41584331-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-41584331-6');
    </script>

    <link rel="stylesheet" href="../../css/scpo.css" type="text/css" />
    <link rel="stylesheet" href="../../css/scpo-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Econometria III
]
.subtitle[
## Modelos de Escolha Qualitativa
]
.author[
### Rafael Bressan
]
.date[
### Esag </br> 2022-10-10
]

---


layout: true

&lt;div class="my-footer"&gt;&lt;img src="../../img/logo/UdescEsag.jpeg" style="height: 60px;"/&gt;&lt;/div&gt; 

---



# Onde estamos?


**Hoje**

1. Modelos de escolha qualitativa!

2. Um aplicativo legal! üòé


---

layout: false

class: separator, middle

# Modelos de Escolha Qualitativa

---

layout: true

&lt;div class="my-footer"&gt;&lt;img src="../../img/logo/UdescEsag.jpeg" style="height: 60px;"/&gt;&lt;/div&gt; 

---

# Modelos de Escolha Qualitativa

.pull-left[

At√© agora, nossos modelos ficaram assim:

`$$\begin{align}
y &amp;= b_0 + b_1 x + e \\
e &amp;\sim D\left(0,\sigma^2\right)
\end{align}$$`

* A suposi√ß√£o de distribui√ß√£o em `\(e\)`:

* Em princ√≠pio implica que `\(y \in \mathbb{R}\)`.

* Resultados de testes, renda, taxas de criminalidade, etc. s√£o todos resultados cont√≠nuos. ‚úÖ
]

--

.pull-right[

Mas alguns resultados s√£o claramente bin√°rios (ou seja, `VERDADEIRO` ou `FALSO`):

* Ou voc√™ trabalha ou n√£o,

* Ou voc√™ tem filhos ou n√£o,

* Ou voc√™ comprou um produto ou n√£o,

* Voc√™ jogou uma moeda e saiu cara ou coroa.
]

---

# Resultados Bin√°rios

* Resultados restritos a `FALSO` vs `VERDADEIRO`, ou `0` vs `1`.

* Ter√≠amos `\(y \in \{0,1\}\)`.

* Nessas situa√ß√µes, estamos principalmente interessados em estimar a **probabilidade de resposta** ou a **probabilidade de sucesso**:

`$$p(x) = \Pr(y=1 | x)$$`
* como `\(p(x)\)` muda quando mudamos `\(x\)`?

     &gt;Se aumentarmos `\(x\)` em uma unidade, como a probabilidade de `\(y=1\)` mudaria?
     
---

# Lembrando o Experimento de Bernoulli

.pull-left[
Lembre-se da [Distribui√ß√£o de Bernoulli?](https://en.wikipedia.org/wiki/Bernoulli_distribution): Chamamos uma vari√°vel aleat√≥ria `\(y \in \{0,1\}\)` tal que

`$$\begin{align}
\Pr(y = 1) &amp;= p \\
\Pr(y = 0) &amp;= 1-p \\
p &amp;\in[0,1]
\end{align}$$`

uma vari√°vel aleat√≥ria de *Bernoulli*.
]

--

.pull-right[
Para n√≥s: *condicione* essas probabilidades em uma covariada `\(x\)`

`$$\begin{align}
\Pr(y = 1 | X = x) &amp;= p(x) \\
\Pr(y = 0 | X = x) &amp;= 1-p(x) \\
p(x) &amp;\in[0,1]
\end{align}$$`

* Particularmente: *valor esperado* (ou seja, a m√©dia) de `\(Y\)` dado `\(x\)`

$$
E[y | x] = 1 \times p(x) + 0 \times (1-p(x)) = p(x)
$$

* Muitas vezes modelamos **expectativas condicionais** üòâ
]
---

# O Modelo de Probabilidade Linear (MPL)

* A op√ß√£o mais simples. Modele a probabilidade de resposta como

$$
\Pr(y = 1 | x) = p(x) = \beta_0 + \beta_1 x_1 + \dots + \beta_K x_K
$$
* Interpreta√ß√£o: *uma mudan√ßa de 1 unidade em `\(x_1\)`, digamos, resulta em uma mudan√ßa de `\(\beta_1\)` em `\(p(x)\)`.*

## Exemplo: Mroz (1987)

* Participa√ß√£o feminina no mercado de trabalho

* Como o status de `inlf` (*na for√ßa de trabalho*) depende da renda familiar da mulher solteira, sua educa√ß√£o, idade e n√∫mero de filhos pequenos?
---

# Mroz 1987


```r
data(mroz, package = "wooldridge")
plot(factor(inlf) ~ age, data = mroz, 
     ylevels = 2:1,
     ylab = "in labor force?")
```

&lt;img src="02-probit_pt_files/figure-html/unnamed-chunk-1-1.svg" style="display: block; margin: auto;" /&gt;


---

# Rodando o MPL

.pull-left[

```r
LPM &lt;- lm(inlf ~ nwifeinc + educ + exper + I(exper^2) + age +I(age^2) + kidslt6,
          data = mroz)
broom::tidy(LPM)
```

```
## # A tibble: 8 √ó 5
##   term         estimate std.error statistic  p.value
##   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)  0.322     0.486       0.662  5.08e- 1
## 2 nwifeinc    -0.00343   0.00145    -2.36   1.86e- 2
## 3 educ         0.0375    0.00735     5.10   4.33e- 7
## 4 exper        0.0383    0.00577     6.63   6.44e-11
## 5 I(exper^2)  -0.000565  0.000189   -2.98   2.96e- 3
## 6 age         -0.00112   0.0225     -0.0497 9.60e- 1
## 7 I(age^2)    -0.000182  0.000258   -0.706  4.80e- 1
## 8 kidslt6     -0.260     0.0341     -7.64   6.72e-14
```
]

.pull-right[
* **id√™ntico** aos nossos modelos de regress√£o linear anteriores

* Apenas `inlf` assume somente dois valores, 0 ou 1.

* Resultados: se a renda da mulher solteira aumenta em 10 (ou seja, 10.000 USD), `\(p(x)\)` cai em 0,034 (isso √© um efeito pequeno!),

* uma crian√ßa pequena adicional reduziria a probabilidade de trabalho em 0,26 (isso √© grande).

* At√© agora, tudo simples.Ô∏è]

---

# MPL: Prevendo probabilidades negativas?!


.pull-left[
&lt;img src="02-probit_pt_files/figure-html/unnamed-chunk-3-1.svg" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;br&gt;
&lt;br&gt;
* As previs√µes do MPL de `\(p(x)\)` n√£o s√£o garantidas no intervalo unit√°rio `\([0,1]\)`.

* Lembre-se: `\(e \sim D\left(0,\sigma^2\right)\)`

* aqui, algumass probabilidades menores que zero!

* Particularmente irritante se voc√™ quiser *previs√µes*: O que √© probabilidade -0,3? ü§î]

---

# MPL no modelo saturado: sem problemas!

.left-wide[

```r
mroz %&lt;&gt;% 
  # classify age into 3 and huswage into 2 classes
  mutate(age_fct = cut(age,breaks = 3,labels = FALSE),
         huswage_fct = cut(huswage, breaks = 2,labels = FALSE)) %&gt;%
  mutate(classes = paste0("age_",age_fct,"_hus_",huswage_fct))

LPM_saturated = mroz %&gt;%
  lm(inlf ~ classes, data = .)
broom::tidy(LPM_saturated)
```

```
## # A tibble: 6 √ó 5
##   term               estimate std.error statistic  p.value
##   &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)          0.611     0.0277    22.0   2.98e-83
## 2 classesage_1_hus_2  -0.611     0.350     -1.75  8.11e- 2
## 3 classesage_2_hus_1  -0.0257    0.0404    -0.635 5.25e- 1
## 4 classesage_2_hus_2  -0.277     0.203     -1.37  1.72e- 1
## 5 classesage_3_hus_1  -0.149     0.0494    -3.01  2.72e- 3
## 6 classesage_3_hus_2  -0.111     0.350     -0.317 7.51e- 1
```

]

.right-thin[
* *modelo saturado* : s√≥ tem vari√°veis explicativas bin√°rias (_dummies_)

* Cada classe: `\(p(x)\)` *dentro daquela c√©lula*.

]

---

# MPL no modelo saturado: sem problemas!

.left-wide[
&lt;img src="02-probit_pt_files/figure-html/saturated-1.svg" style="display: block; margin: auto;" /&gt;
]

.right-thin[

* Cada segmento de linha: `\(p(x)\)` *dentro daquela c√©lula*.

* Por exemplo. as mulheres da faixa et√°ria mais jovem e de menor renda do marido (classe `age_1_hus_1`) t√™m a maior probabilidade de trabalhar (0.611).
]


---

# Modelos de Resposta Bin√°ria N√£o-Lineares

Nesta classe de modelos mudamos a forma como modelamos a probabilidade de resposta `\(p(x)\)`. Em vez da estrutura linear simples de cima, escrevemos

$$
\Pr(y = 1 | x) = p(x) = G \left(\beta_0 + \beta_1 x_1 + \dots + \beta_K x_K \right)
$$
--

* ***quase*** id√™ntico ao MPL!

* exceto que o *√≠ndice linear* `\(\beta_0 + \beta_1 x_1 + \dots + \beta_K x_K\)` agora est√° dentro da ***fun√ß√£o de liga√ß√£o*** `\(G(\cdot)\)` (i.e. _link function_).

* Propriedade principal de `\(G\)`: transforma qualquer `\(z\in \mathbb{R}\)` em um n√∫mero no intervalo `\((0,1)\)`.

* Isso resolve nosso problema de previs√µes fora do intervalo `\(\left[0, 1\right]\)` para probabilidades.
---

# Modelos de Resposta Bin√°ria N√£o-Lineares

## `\(G\)`: *probit* e *logit*

.left-wide[
&lt;img src="02-probit_pt_files/figure-html/cdfs-1.svg" style="display: block; margin: auto;" /&gt;
]

.right-thin[

&lt;br&gt;
Para **probit** e **logit**:

1. qualquer valor `\(x\)` resulta em um valor `\(p(x)\)` entre 0 e 1.

1. estritamente crescentes.

1. Logit tem *caudas mais longas*.

]

---

# Modelos de Resposta Bin√°ria N√£o-Lineares

## `\(G\)`: *probit* e *logit*

.left-wide[
&lt;img src="02-probit_pt_files/figure-html/cdfs2-1.svg" style="display: block; margin: auto;" /&gt;
]

.right-thin[

&lt;br&gt;
**Probit**:

* `\(G(z)=\Phi(z)\)` Distribui√ß√£o Normal

**Logit**:

* `\(G(z)=\Lambda(z)=\frac{1}{1+\exp(-z)}\)` Distribui√ß√£o Log√≠stica
]

---
# Modelos de Resposta Bin√°ria N√£o-Lineares

## Rodando probit e logit no `R`: a fun√ß√£o `glm`

* Usamos a fun√ß√£o `glm` para rodar um **modelo linear generalizado**

* Isso *generaliza* nosso modelo linear padr√£o. Temos que especificar uma `fam√≠lia` e um `link`:


```r
probit &lt;- glm(inlf ~ age, 
                    data = mroz, 
                    family = binomial(link = "probit"))

logit &lt;- glm(inlf ~ age, 
                    data = mroz, 
                    family = binomial(link = "logit"))
```

---

# Interpreta√ß√£o

.pull-left[

```r
modelsummary::modelsummary(list("probit" = probit,"logit" = logit))
```

&lt;table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; probit &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; logit &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.707 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.136 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.248) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.398) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; age &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.013 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.020 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.006) &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.009) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 753 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 753 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; AIC &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1028.9 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1028.9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; BIC &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1038.1 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1038.1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Log.Lik. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí512.442 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí512.431 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 4.828 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 4.858 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; RMSE &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.49 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.49 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

.pull-right[
* coeficiente de probit para `idade` √© -0.013

* logit: -0.02 para logit,

* impacto da idade na probabilidade de trabalhar √© **negativo**

* No entanto, **qu√£o** negativo? N√£o podemos dizer!]

---

# Interpreta√ß√£o

$$
\Pr(y = 1 | \text{age})= G \left(x \beta\right) = G \left(\beta_0 + \beta_1 \text{age} \right) 
$$
e o *efeito marginal* de `idade` na probabilidade de resposta √©

`$$\frac{\partial{\Pr(y = 1 | \text{age})}}{ \partial{\text{age}}} = g \left(\beta_0 + \beta_1 \text{age} \right) \beta_1$$`

* `\(g\)` √© definida como `\(g(z) = \frac{dG}{dz}(z)\)` - a primeira derivada de `\(G\)` (sendo `\(G\)` uma distribui√ß√£o, `\(g\)` √© a fun√ß√£o densidade).

* dado que `\(G\)` √© n√£o-linear, isso significa que `\(g\)` n√£o ser√° constante. Voc√™ pode experimentar isso usando este [aplicativo aqui](https://floswald.shinyapps.io/marginal_effects_of_logit_probit/):


---

# Interpreta√ß√£o

***N√£o h√° um √∫nico efeito marginal*** nesses modelos, pois isso depende de *onde avaliamos* a express√£o anterior. Na pr√°tica, existem duas abordagens comuns:

1. reporte o **efeito parcial na m√©dia** (PEA): `$$PEA(X_j)=g(\bar{x} \beta) \beta_j$$`

1. relate o **efeito parcial m√©dio** (APE): `$$APE(X_j)=\frac{1}{n} \sum_{i=1}^N g(x_i \beta) \beta_j$$`

Felizmente, existem pacotes dispon√≠veis que nos ajudam a calcular esses efeitos marginais com bastante facilidade. Um deles se chama [`marginaleffects`](https://vincentarelbundock.github.io/marginaleffects/index.html), e o usamos da seguinte forma:

---

# Interpreta√ß√£o


```r
f &lt;- "inlf ~ age + kidslt6 + nwifeinc" # setup a formula
glms &lt;- list()
glms$probit &lt;- glm(formula = f, 
                    data = mroz, 
                    family = binomial(link = "probit"))
glms$logit &lt;- glm(formula = f, 
                    data = mroz, 
                    family = binomial(link = "logit"))
# now the marginal effects versions
mfx_mean &lt;- lapply(glms, marginaleffects, newdata = "mean")
mfx_avg &lt;- lapply(glms, marginaleffects)
```


---

# Interpreta√ß√£o

&lt;table style='NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;' class="table lightable-classic"&gt;
 &lt;thead&gt;
&lt;tr&gt;
&lt;th style="empty-cells: hide;" colspan="1"&gt;&lt;/th&gt;
&lt;th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #111111; margin-bottom: -1px; "&gt;PEA&lt;/div&gt;&lt;/th&gt;
&lt;th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #111111; margin-bottom: -1px; "&gt;APE&lt;/div&gt;&lt;/th&gt;
&lt;/tr&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; probit &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; logit &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; probit  &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; logit  &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; age &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.014*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.014*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.013*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.013*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.003) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.003) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.002) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.002) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; kidslt6 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.314*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.322*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.290*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.292*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.044) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.046) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.036) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.037) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; nwifeinc &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.004** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.005** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.004** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí0.004** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.002) &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.002) &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.001) &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.002) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 753 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 753 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 753 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 753 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Log.Lik. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí478.395 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí478.377 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí478.395 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ‚àí478.377 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 21.784 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 20.280 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 21.784 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 20.280 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; RMSE &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.47 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.47 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.47 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.47 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;

---
layout: false
class: separator, middle


# Qualidade do Ajuste em Modelos Bin√°rios

---
layout: true

&lt;div class="my-footer"&gt;&lt;img src="../../img/logo/UdescEsag.jpeg" style="height: 60px;"/&gt;&lt;/div&gt; 

---
# Qualidade do Ajuste em Modelos Bin√°rios

* N√£o existe `\(R^2\)` universalmente aceito para modelos bin√°rios.

* Podemos pensar em um *pseudo* `\(R^2\)` que compara nosso modelo com outro sem regressores:


```r
glms$probit0 &lt;- update(glms$probit, formula = . ~ 1)
1 - as.vector(logLik(glms$probit)/logLik(glms$probit0))
```

```
## [1] 0.07084972
```

--

* Mas isso n√£o √© super informativo (ao contr√°rio do `\(R^2\)`). As altera√ß√µes no valor da log-verossimilhan√ßa s√£o altamente n√£o lineares.

---
# Qualidade do Ajuste em Modelos Bin√°rios

* Vamos verificar **precis√£o** - qual √© a propor√ß√£o prevista corretamente! `round(fitted(x))` atribui `1` se a prob `\(&gt; 0.5\)` previsto.


```r
kbl(prop.table(table(true = mroz$inlf, pred = round(fitted(glms$probit)))))
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; 0 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; 1 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1699867 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2616202 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1221780 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.4462151 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

# Curvas ROC (Receiver Operating Characteristics)

* O corte de 0,5 √© arbitr√°rio. E se todas as probabilidades previstas forem `\(&gt; 0,5\)`, mas nos dados houver cerca de 50% de zeros?

* Vamos escolher um *corte arbitr√°rio* `\(c \in (0,1)\)` e verificar a precis√£o de cada valor. Isso d√° uma vis√£o melhor.
--

* Al√©m disso, podemos confrontar a **taxa de verdadeiros positivos** (TPR) com a **taxa de falsos positivos** (FPR).
     1. TPR: n√∫mero de mulheres corretamente previstas para trabalhar dividido pelo n√∫mero de mulheres que trabalham.
     2. FPR: n√∫mero de mulheres incorretamente previstas para trabalhar dividido pelo n√∫mero de mulheres n√£o trabalhadoras.
    
--
* Plotar FPR vs TPR para cada `\(c\)` define a curva **ROC**.

* Um bom modelo tem uma curva ROC no canto superior esquerdo: FPR = 0, TPR = 1.
---

# Curvas ROC (Receiver Operating Characteristics)

.left-wide[

```r
pred &lt;- prediction(fitted(glms$probit), mroz$inlf)
par(mfrow = c(1,2), mar = lowtop)
plot(performance(pred,"acc"))
plot(performance(pred,"tpr","fpr"))
abline(0, 1, lty = 2, col = "red")
```

&lt;img src="02-probit_pt_files/figure-html/unnamed-chunk-10-1.svg" style="display: block; margin: auto;" /&gt;
]

.right-thin[
&lt;br&gt;
&lt;br&gt;
* Melhor precis√£o em torno de `\(c=0,6\)`

* ROC sempre acima da linha de 45 graus. Melhor do que atribui√ß√£o aleat√≥ria (jogar uma moeda)! Sim!

]

---
# Estima√ß√£o de M√°xima Verossimilhan√ßa

* Ao inv√©s de usar m√©dia e vari√¢ncia condicionais, usaremos a distribui√ß√£o condicional completa

* Amostra *iid* `\(\lbrace y_i, x_i \rbrace_{i=1}^N\)`. Queremos estimar a distribui√ß√£o `\(f(y|x)\)`

* **Hip√≥tese:** esta distribui√ß√£o √© conhecida, a n√£o ser por um n√∫mero finito de par√¢metros fixos.
    + Impomos um modelo param√©trico para a densidade condicional
    
---

# Estima√ß√£o de M√°xima Verossimilhan√ßa

## Exemplo Probit

.pull-left[
* `\(y_i^*=x_i\theta + \varepsilon_i\)`, sendo `\(\varepsilon_i\sim N(0,1)\)`

* N√£o observamos `\(y_i^*\)`, apenas `\(y_i\)`
]

--

.pull-right[
`$$\begin{equation*}
y_i = \begin{cases}
1 \text{ se } y_i^* &gt; 0\\ 
0 \text{ se } y_i^* \leq 0
\end{cases}
\end{equation*}$$`
]

---
# Estima√ß√£o de M√°xima Verossimilhan√ßa

## Exemplo Probit

* Dadas as especifica√ß√µes acima:

.pull-left[
`$$\begin{align*}
P(y_i=1|x_i)&amp;=P(y_i* &gt; 0|x_i)\\
&amp;=P(\varepsilon_i &gt; -x_i\theta |x_i)\\
&amp;=1-\Phi(-x_i\theta)\\
&amp;=\Phi(x_i\theta)
\end{align*}$$`
]
--
.pull-right[
`$$\begin{align*}
P(y_i=0|x_i)&amp;=P(y_i* \leq 0|x_i)\\
&amp;=P(\varepsilon_i \leq -x_i\theta |x_i)\\
&amp;=\Phi(-x_i\theta)\\
&amp;=1-\Phi(x_i\theta)
\end{align*}$$`
]

---
# Estima√ß√£o de M√°xima Verossimilhan√ßa

## Exemplo Probit

* A densidade condicional pode ser escrita como:

`$$f(y_i|x_i)=\Phi(x_i\theta)^{y_i}\cdot [1-\Phi(x_i\theta)]^{1-y_i}$$`
--

* Esta √© a probabilidade de ocorr√™ncia de um ponto `\((x_i, y_i)\)`. Para o conjunto de dados observados temos a ***fun√ß√£o de verossimilhan√ßa***

`$$\ell(\theta)=\Pi_{i=1}^N \Phi(x_i\theta)^{y_i}\cdot [1-\Phi(x_i\theta)]^{1-y_i}$$`

--

* M√°xima Verossimilhan√ßa consiste em ***maximizar a fun√ß√£o de verossimilhan√ßa*** em rela√ß√£o aos par√¢metros, `\(\theta\)`.

* Podemos maximizar a ***log-verossimilhan√ßa*** por praticidade. `\(\mathcal{L}(\theta)=\log(\ell(\theta))=\sum_{i=1}^N y_i\log(\Phi(x_i\theta))+(1-y_i)\log(1-\Phi(x_i\theta))\)`

---
# Estima√ß√£o de M√°xima Verossimilhan√ßa

## Exemplo Probit

`$$\hat\theta = \arg \max_{\theta} \mathcal{L}(\theta)$$`

* O vetor de ***score*** √© dado pela derivada da log-verossimilhan√ßa em rela√ß√£o a cada um dos par√¢metros

`$$s(\theta)=\nabla_\theta \mathcal{L}(\theta)=\left[\frac{\partial\mathcal{L}(\theta)}{\partial\theta_1}, \ldots, \frac{\partial\mathcal{L}(\theta)}{\partial\theta_k}\right]^{\prime}$$`
* A Hessiana √© a matriz de segundas derivadas

`$$H(\theta)=\nabla^2_\theta \mathcal{L}(\theta)$$`

---
# Estima√ß√£o de M√°xima Verossimilhan√ßa

## Exemplo Probit

Exerc√≠cio: Calcule o _score_ do modelo probit.

R.: `$$s(\theta)=\sum_{i}\frac{\phi(x_i\theta)}{\Phi(x_i\theta)[1-\Phi(x_i\theta)]}(y_i-\Phi(x_i\theta))x_i$$`

---
# M√©todo dos Momentos Generalizado

## M√©todo dos Momentos (MM)

* Podemos utilizar momentos populacionais para identificar par√¢metros
    + `\(E[u_i]=0\)` √© um exemplo
--
* De fato, ***tanto MQO quanto VI*** podem ser entendidos como estimadores MM!

* Quais s√£o os momentos utilizados no MQO?

--

* `\(E[u]=0\)` e `\(E[xu]=0\)`, que s√£o as equa√ß√µes normais do MQO

* O MM resolve o an√°logo amostral destas equa√ß√µes

---

# M√©todo dos Momentos Generalizado

## M√©todo dos Momentos (MM)

.left-wide[

* Vamos considerar um _setup_ mais geral:
* `\(\theta_0\in\mathbb{R}^p\)` √© um vetor dos par√¢metros da popula√ß√£o
* `\(m(\theta_0)\equiv E[g(Z_i, \theta_0)]=0\)`, s√£o as equa√ß√µes de momento
* `\(g(Z_i, \theta)\)` √© uma fun√ß√£o vetorial `\(r\times 1\)`
* `\(Z_i\equiv (X_i, Y_i)\)` √© uma observa√ß√£o do conjunto de dados 
* `\(\theta_0\)` √© a √∫nica solu√ß√£o para a equa√ß√£o de momento
* MM vai resolver o an√°logo amostral:

`$$\hat{m}(\hat\theta)=\frac{1}{N}\sum_{i=1}^N g(Z_i, \hat\theta)=0$$`
]

--

.right-thin[
&lt;!-- ![](https://media.giphy.com/media/ghuvaCOI6GOoTX0RmH/giphy.gif) --&gt;
![](https://media.giphy.com/media/YmnRIWXjSkct9ZZtNZ/giphy.gif)
]
---

# M√©todo dos Momentos Generalizado

## Clarificando

.left-wide[
* Considere o MQO. Podemos escrever duas equa√ß√£o de momento que identificam os par√¢metros do modelo

`$$\hat{m}(\hat\beta)=\begin{cases}
\frac{1}{N}\sum_{i=1}^N(y_i-\hat\beta_0-\hat\beta_1 x_i)=0\\
\frac{1}{N}\sum_{i=1}^Nx_i(y_i-\hat\beta_0-\hat\beta_1 x_i)=0
\end{cases}$$`

* O MM escreve momentos populacionais em termos dos par√¢metros e resolve o sistema de equa√ß√µes, simples!
]
--

.right-thin[
.center[![](https://media.giphy.com/media/KU60D6Of7xb4qmFQwT/giphy.gif)]
]

---
# M√©todo dos Momentos Generalizado

## GMM

* Podemos generalizar o m√©todo dos momentos. Da√≠ o nome ***generalized method of moments*** - **GMM**

* Minimizar a norma `\({\displaystyle \|{\hat {m}}(\theta )\|_{W}^{2}={\hat {m}}(\theta )^{\mathsf {T}}\,W{\hat {m}}(\theta)}\)`

* Onde `\(W\)` √© uma matriz positiva definida

* `\({\displaystyle {\hat {\theta }}=\operatorname {arg} \min _{\theta \in \Theta }{\bigg (}{\frac {1}{N}}\sum _{i=1}^{N}g(Z_{i},\theta ){\bigg )}^{\mathsf {T}}{W}{\bigg (}{\frac {1}{N}}\sum_{i=1}^{N}g(Z_{i},\theta ){\bigg )}}\)`

--
* Especialmente √∫til quando temos mais equa√ß√µes de momento do que par√¢metros

---
# M√©todo dos Momentos Generalizado

## Aplica√ß√µes de GMM

* MQO, VI e MLE podem ser obtidos a partir de um GMM

* Aplica√ß√µes diversas em
    + _Cross-Section_: modelos n√£o-lineares com vari√°veis end√≥genas 
    + S√©ries Temporais: correla√ß√£o serial e heterocedasticidade
    + Painel: extens√µes do modelo de efeitos fixos

* Veja mais em [Wooldridge (2001) JEP](https://pubs.aeaweb.org/doi/pdfplus/10.1257/jep.15.4.87)

---

# Leitura Recomendada

* WOOLDRIDGE, Jeffrey M. Introdu√ß√£o √† econometria: uma abordagem moderna. S√£o Paulo: Cengage Learning, 2016. Tradu√ß√£o da 4¬™ edi√ß√£o norte-americana por Jos√© Antonio Ferreira. Cap√≠tulo 17 Modelo com Vari√°veis Dependentes Limitadas e Corre√ß√µes da Sele√ß√£o Amostral.

* GUJARATI, Damodar N.; PORTER, Dawn C. Econometria b√°sica. Porto Alegre: Amgh Editora, 2011. - 5. ed. Cap√≠tulo 15 Modelos de regress√£o de resposta qualitativa

* WOOLDRIDGE, Jeffrey M. Econometric Analysis of Cross Section and Panel Data. MIT press, 2010. Second Edition. Chapter 15 Binary Response Models

---

layout: false

class: title-slide-final, middle
background-image: url(../../img/logo/UdescEsag.jpeg)
background-size: 350px
background-position: 9% 19%

# AT√â A PR√ìXIMA AULA!

Com a Lista 1 feita! ‚úÖ

.footnote[
[1]: Este slides foram baseados nas aulas de econometria da [SciencesPo Department of Economics](https://github.com/ScPoEcon/ScPoEconometrics-Slides)
]


|                                                                                                            |                                   |
| :--------------------------------------------------------------------------------------------------------- | :-------------------------------- |
| &lt;a href="https://github.com/rfbressan/econometria3_slides"&gt;.ScPored[&lt;i class="fa fa-link fa-fw"&gt;&lt;/i&gt;] | Slides |
| &lt;a href="http://github.com/rfbressan"&gt;.ScPored[&lt;i class="fa fa-github fa-fw"&gt;&lt;/i&gt;]                          | @rfbressan                      |
| &lt;a href="https://raw.githack.com/rfbressan/econometria3_slides/master/lectures/02-probit/lista_I_pt.html"&gt;.ScPored[&lt;i class="fa fa-list fa-fw"&gt;&lt;/i&gt;] | Lista de Exerc√≠cios I |

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="../../js/ru_xaringan.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
