<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Econometria III</title>
    <meta charset="utf-8" />
    <meta name="author" content="Rafael Bressan" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/5235085b15.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41584331-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-41584331-6');
    </script>

    <link rel="stylesheet" href="../../css/scpo.css" type="text/css" />
    <link rel="stylesheet" href="../../css/scpo-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Econometria III
]
.subtitle[
## Dados em Painel
]
.author[
### Rafael Bressan
]
.date[
### Esag </br> 2022-11-17
]

---


layout: true

&lt;div class="my-footer"&gt;&lt;img src="../../img/logo/UdescEsag.jpeg" style="height: 60px;"/&gt;&lt;/div&gt; 

---




# Dados de Cortes Transversais

.pull-left[
At√© agora, lidamos com dados que se parecem com isso:


| Condado | CrimeRate | ProbofArrest |
|:-------:|:---------:|:------------:|
|    1    | 0.0398849 |   0.289696   |
|    3    | 0.0163921 |   0.202899   |
|    5    | 0.0093372 |   0.406593   |
|    7    | 0.0219159 |   0.431095   |
|    9    | 0.0075178 |   0.631579   |
]

.pull-right[

* Temos um identificador de unidade (como `Condado` aqui)

* Vari√°veis observ√°veis em cada unidade

* Geralmente chamado de conjunto de dados de **se√ß√£o transversal** (_cross-section_)

* Fornece visualiza√ß√£o de um momento instant√¢neo

* Cada linha √© uma *observa√ß√£o*, cada coluna uma *vari√°vel*
]

---

# Dados em Painel

.pull-left[
Agora, vamos adicionar um √≠ndice de `tempo`: `Ano`.


| Condado | Ano | CrimeRate | ProbofArrest |
|:-------:|:---:|:---------:|:------------:|
|    1    | 81  | 0.0398849 |   0.289696   |
|    1    | 82  | 0.0383449 |   0.338111   |
|    1    | 83  | 0.0303048 |   0.330449   |
|    1    | 84  | 0.0347259 |   0.362525   |
|    1    | 85  | 0.0365730 |   0.325395   |
|    1    | 86  | 0.0347524 |   0.326062   |
|    1    | 87  | 0.0356036 |   0.298270   |
|    3    | 81  | 0.0163921 |   0.202899   |
|    3    | 82  | 0.0190651 |   0.162218   |
]

.pull-right[

* Ao lado do identificador da unidade (`Condado`) temos agora `Ano`

* Agora um par (`Condado`, `Ano`) indexa uma observa√ß√£o.

* Chamamos isso de conjunto de dados em **painel** ou **longitudinal**

* Podemos rastrear unidades *ao longo do tempo*.

* **Se√ß√µes transversais repetidas** quando n√£o s√£o os mesmos ind√≠viduos

]
---

# Taxas de Criminalidade e Probabilidade de Pris√£o

* Os dados acima podem ser carregados com
    
    ```r
    data(crime4,package = "wooldridge")
    ```

* Eles s√£o de [C. Cornwell e W. Trumball (1994), ‚ÄúEstimating the Economic Model of Crime with Panel Data‚Äù](https://www.amherst.edu/media/view/121570/original/CornwellTrumbullCrime%2BElasticities.pdf).

--

* Uma pergunta aqui: *qual √© o tamanho do efeito dissuasor da aplica√ß√£o da lei*? Se voc√™ sabe que √© mais prov√°vel que seja preso, ser√° menos prov√°vel que cometa um crime?

--

* Isso √© complicado: a criminalidade alta *causa* uma resposta policial mais forte, que atua como um impedimento, ou o crime √© baixo porque o impedimento √© forte para come√ßar?

* Isso √†s vezes √© chamado de uma situa√ß√£o de *modelo de equa√ß√£o simult√¢nea*: a resposta da pol√≠cia afeta o crime, mas o crime afeta a resposta da pol√≠cia

`\begin{align}
police &amp;= \alpha_0 + \alpha_1 crime \\
crime &amp;= \beta_0 + \beta_1 police
\end{align}`

---

# Taxas de Criminalidade e Probabilidade de Pris√£o

.pull-left[

* A maioria da literatura anterior a esse artigo estimava equa√ß√µes simult√¢neas de dados de corte transversal

* Cornwell e Trumball est√£o preocupados com a **heterogeneidade n√£o observada** entre as jurisdi√ß√µes.

* Por qu√™? O que poderia dar errado?

]

.pull-right[

* Vamos escolher 4 condados do nosso conjunto de dados

* Vejamos a rela√ß√£o entre taxa de criminalidade vs probabilidade de pris√£o

* Primeiro para todos eles juntos como uma √∫nica se√ß√£o transversal

* Em seguida, aproveitando a estrutura do painel (ou seja, cada condado ao longo do tempo).

]


---

# Crime vs Pris√£o em Se√ß√£o Transversal

.left-thin[

1. Subconjunto de dados para 4 condados

1. plotar taxa de criminalidade versus probabilidade de pris√£o.


]

.right-wide[
&lt;img src="06-panel_pt_files/figure-html/unnamed-chunk-4-1.svg" style="display: block; margin: auto;" /&gt;
]

---

# Crime vs Pris√£o em Se√ß√£o Transversal

## relacionamento positivo!

.pull-left[

* Vemos uma linha inclinada para cima!

* Maior probabilidade de pris√£o est√° associada a maiores taxas de criminalidade.

* Qu√£o forte √© o efeito?


```r
xsection = lm(crmrte ~ prbarr, css)
coef(xsection)[2]  # gets slope coef
```

```
##     prbarr 
## 0.06480104
```

]

--

.pull-right[




* Aumentar a probabilidade de pris√£o em 0.1 unidade (ou seja, 10 pontos percentuais), aumenta a taxa de criminalidade em 0.00648. 

* Aumento de 10 p.p. na probabilidade de pris√£o (por exemplo, `prbarr` passa de 0,2 para 0,3) ...

* ... est√° associado a um aumento na taxa de criminalidade de 0.021 para 0.028, ou 33.33 por cento de aumento na taxa de criminalidade.

]

---

# Crime vs Pris√£o em Se√ß√£o Transversal

## Ok, mas o que isso *significa*?


* Literalmente: condados onde existe maior probabilidade de ser preso tamb√©m t√™m maior √≠ndice de criminalidade.

* Ent√£o, isso significa que pol√≠cia mais eficiente em prender criminosos e, portanto, a probabilidade de ser preso √© mais alta, causa aumento de criminalidade?

--

* Do que depende a efici√™ncia da pol√≠cia?

* O n√≠vel de pobreza em um condado importa para isso?

* As leis locais?

* ü§Ø Uau, parece haver muitas coisas deixadas de fora desta imagem simples. 


---

# Varia√ß√£o Intragrupo e Entre-grupos 

Voc√™ ouvir√° frequentemente os termos varia√ß√£o *intra* (_within_) e *entre* (_between_) em contextos de dados de painel.

.pull-left[

## Varia√ß√£o Intra

* coisas que mudam *dentro de cada grupo* ao longo do tempo:

* aqui dissemos or√ßamentos policiais

* e os n√≠veis de pobreza mudariam dentro de cada grupo e ao longo do tempo.

]

.pull-right[

## Varia√ß√£o Entre

* Coisas que s√£o **fixas** para cada grupo ao longo do tempo:

* Leis e costumes locais

* Direitos Civis

* diferem apenas **entre** grupos

]
---

# Varia√ß√£o Intragrupo e Entre-grupos

.left-wide[
&lt;img src="06-panel_pt_files/figure-html/unnamed-chunk-7-1.svg" style="display: block; margin: auto;" /&gt;
]

---

# Apresentando o *Efeito Fixo*

.left-wide[
&lt;img src="../../img/photos/crime_rate_dag.png" style="display: block; margin: auto;" /&gt;
]

.right-thin[

* Coletamos todos as caracter√≠sticas invari√°veis no tempo e espec√≠ficas do grupo no fator `Condado`.

* Controla todos os fatores que *n√£o* variam ao longo do tempo dentro de cada unidade.

* Chamamos `Condado` de **efeito fixo**.
]


---
layout: false
class: separator, middle

# Estima√ß√£o de Efeitos Fixos


---
layout: true

&lt;div class="my-footer"&gt;&lt;img src="../../img/logo/UdescEsag.jpeg" style="height: 60px;"/&gt;&lt;/div&gt; 

---

# Vari√°vel Omitida, VI e Dados em Painel

Vimos *vi√©s de vari√°vel omitida* (OVB). Por exemplo, se o modelo verdadeiro for:

$$
y_i = \beta_0 + \beta_1 x_i + c_i + u_i
$$
se `\(c_i\)` √© n√£o observ√°vel e `\(Cov(x_i, c_i)\neq0 \Rightarrow E[v_i|x_i]\neq 0\)` com `\(v_i = u_i + c_i\)` erro composto
--

.pull-left[

## Solu√ß√£o Se√ß√£o Transversal

* onde `\(c_i\)` √© vari√°vel omitida. **Vi√©s**! üò≠ 

* Encontre IV correlacionado com probabilidade de pris√£o, mas n√£o condado
]

--

.pull-right[

## Solu√ß√£o Dados em Painel

`$$y_{it} = \beta_1 x_{it} + c_i + u_{it},\quad t=1,2,...T$$`
* `\(c_i\)`: *efeito fixo individual* ou *heterogeneidade n√£o observada*.

* `\(c_i\)`: √© fixo ao longo do tempo (eg. costumes locais), mas pode ser correlacionado com `\(x_{it}\)`!
]



---

# Regress√£o com Vari√°vel _Dummy_


* Abordagem mais simples: inclua uma vari√°vel _dummy_ para cada grupo `\(i\)`.

* Isso √© literalmente *controlar para o condado* `\(i\)`

* Cada `\(i\)` tem seu pr√≥prio intercepto `\(c_i\)`

---

# Regress√£o com Vari√°vel _Dummy_

`$$y_{it} = \beta_1 x_{it} + c_i + u_{it},\quad t=1,2,...T$$`


```r
mod &lt;- list()
mod$dummy &lt;- lm(crmrte ~ prbarr + factor(county), 
                data = css)
broom::tidy(mod$dummy)
```

<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-8">
<col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0449</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.00456</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">9.87</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">9.85e-10</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">prbarr</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.0284</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.0136&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-2.08</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.0486&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">factor(county)3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-0.025&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.00254</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-9.82</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.07e-09</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">factor(county)23</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.0085</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.00166</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-5.13</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.41e-05</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">factor(county)145</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-0.0065</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0016&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-4.07</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.00047&nbsp;</td></tr>
</table>



---

# Regress√£o com Vari√°vel _Dummy_

.left-wide[
&lt;img src="06-panel_pt_files/figure-html/dummy-1.svg" style="display: block; margin: auto;" /&gt;
]

.right-thin[
* *Dentro* de cada condado, relacionamento **negativo**!!

* Diferentes interceptos

* Coeficiente angular ***√∫nico*** `\(\beta\)`. (as linhas s√£o paralelas).

* Grupo de refer√™ncia 1 (intercepto da tabela).
]

---

# Primeira Diferen√ßa

Se tivermos apenas dois per√≠odos, `\(T=2\)`, poder√≠amos apenas ***diferenciar*** os per√≠odos
    
`$$\begin{align}y_{i1} &amp;= \beta_1 x_{i1} + c_i + u_{i1} \\y_{i2} &amp;= \beta_1 x_{i2} + c_i + u_{i2} \\&amp; \Rightarrow \\
y_{i1}-y_{i2} &amp;= \beta_1 (x_{i1} - x_{i2}) + c_i-c_i + u_{i1}-u_{i2} \\\Delta y_{i} &amp;= \beta_1 \Delta x_{i} + \Delta u_{i}\end{align}$$`

E para recuperar o par√¢metro de interesse `\(\beta_1\)` rodamos


```r
lm(deltay ~ deltax, diff_data) 
```
    
    
---

# A Transforma√ß√£o Intragrupo (_Within_)

.pull-left[
* Com `\(T&gt;2\)` precisamos de uma abordagem diferente

* Um conceito importante √© a chamada transforma√ß√£o **intragrupo** (*within*)

* Ent√£o, *controlando a identidade do grupo* e observando apenas a ***varia√ß√£o dentro*** deste grupo

]

.pull-right[

* Seja `\(\bar{x}_i\)` a m√©dia *ao longo do tempo* dos valores `\(x\)` de `\(i\)`:

`$$\bar{x}_i = \frac{1}{T} \sum_{t=1}^T x_{it}$$`

1. para todas as vari√°veis, calcule sua m√©dia no tempo para cada grupo `\(i\)`: `\(\bar{x}_i,\bar{y}_i\)` etc.
1. para cada **observa√ß√£o**, subtraia essa m√©dia de tempo do valor real e defina `\(\ddot{x}_{it}=x_{it} - \bar{x}_i\)` e `\(\ddot{y}_{it}=y_{it}-\bar{y}_i\)`
1. Por fim, regresse `\(\ddot{y}_{it}\)` em `\(\ddot{x}_{it}\)`
]

---

# A Transforma√ß√£o Intragrupo (_Within_)

- Se `\(y_{it} = \beta_1 x_{it} + c_i + u_{it}\)`, ent√£o

--
$$
`\begin{align*}
\bar{y}_i&amp;=\frac{1}{T}\sum_t y_{it}\\
&amp;=\frac{1}{T}\left[ \beta_1\sum_t x_{it}+\sum_t c_{i}+\sum_t u_{it}\right]\\
&amp;=\beta_1\bar{x}_i+c_i+\bar{u}_i
\end{align*}`
$$
Logo,

$$
`\begin{align*}
\ddot{y}_{it}&amp;=y_{it}-\bar{y}_i\\
&amp;=\beta_1 x_{it} + c_i + u_{it} - \left(\beta_1\bar{x}_i+c_i+\bar{u}_i\right)\\
&amp;=\beta_1\ddot{x}_{it} + \ddot{u}_{it}
\end{align*}`
$$
---

# A Transforma√ß√£o Intragrupo (_Within_)
## Graus de liberdade

- `\(\ddot{y}_{it}=\beta_1\ddot{x}_{1,it} + \beta_2\ddot{x}_{2,it} + \ldots + \beta_k\ddot{x}_{k,it} + \ddot{u}_{it}\)`

- A princ√≠pio temos `\(NT - k\)` graus de liberdade

--

- ‚ö†Ô∏è Isso n√£o √© verdade!!

--

- Tivemos de calcular `\(N\)` **m√©dias intragrupo**. Perdemos esses graus de liberdade

- _gl_: `\(NT-N-k=N(T-1)-k\)`

--

- Quanto mais efeitos fixos adicionarmos na regress√£o, mais ***gl*** iremos perder 

---

# A Transforma√ß√£o Intragrupo (_Within_)

## Solu√ß√£o Manual no `R`

Isso *funciona* para o nosso problema com o efeito fixo `\(c_i\)` porque `\(c_i\)` n√£o varia no tempo por suposi√ß√£o! A m√©dia de uma constante √© elas mesma, `\(\bar c_i = c_i\)`

--

`$$y_{it}-\bar{y}_i = \beta_1 (x_{it} - \bar{x}_i) + c_i - \bar c_i + u_{it}-\bar{u}_i$$`


√â f√°cil fazer voc√™ mesmo! Primeiro vamos calcular os valores centralizados:


```r
cdata &lt;- css %&gt;%
  group_by(county) %&gt;%
  mutate(mean_crime = mean(crmrte),
         mean_prob = mean(prbarr)) %&gt;%
  mutate(demeaned_crime = crmrte - mean_crime,
         demeaned_prob = prbarr - mean_prob)
```

---

# A Transforma√ß√£o Intragrupo (_Within_)

## Solu√ß√£o Manual no `R`

Em seguida, rodamos os modelos ***Pooled***  e ***Transforma√ß√£o Intragrupo*** com MQO simples:


```r
mod$pooled &lt;- lm(crmrte ~ prbarr, data = cdata)
mod$intra &lt;- lm(demeaned_crime ~ demeaned_prob, data = cdata)
```

---

# A Transforma√ß√£o Intragrupo (_Within_)

## Solu√ß√£o Manual no `R`

.pull-left[

<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:tab1">
<col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;"> </th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">pooled</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">dummy</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">intra</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">(Intercept)</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">0.009</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">0.045</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">0.000</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;"></td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">(0.005)</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">(0.005)</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">(0.001)</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">prbarr</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">0.065</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;"><span style="color: rgb(255, 0, 0);">-0.028</span></td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;"><span style="color: rgb(255, 0, 0);"></span></td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;"></td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">(0.016)</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">(0.014)</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;"></td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">demeaned_prob</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;"></td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;"><span style="color: rgb(255, 0, 0);"></span></td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;"><span style="color: rgb(255, 0, 0);">-0.028</span></td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;"></td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;"></td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;"></td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">(0.013)</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">R2</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">0.390</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">0.893</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal; font-size: 14pt;">0.159</td></tr>
</table>

]

--

.pull-right[

* A estimativa para `prbarr` √© positiva no ***Pooled***

* Cuidando da heterogeneidade n√£o observada `\(c_i\)`...

* ...seja incluindo uma ***dummy*** para cada `\(i\)` ou transforma√ß√£o ***intragrupo*** 

* obtemos: -0.028 .

]

---

# A Transforma√ß√£o Intragrupo (_Within_)

## Interpretando as estimativas




* Como interpretar essas inclina√ß√µes negativas?

* Olhamos para uma √∫nica unidade `\(i\)` e perguntamos:

&gt; se a probabilidade de pris√£o em `\(i\)` aumentar em 10 pontos percentuais (ou seja, de 0,2 para 0,3) do ano `\(t\)` para `\(t+1\)`, esperamos que os crimes por pessoa caiam de 0.039 para 0.036, ou por -7.69 por cento.

&lt;img src="06-panel_pt_files/figure-html/unnamed-chunk-13-1.svg" style="display: block; margin: auto;" /&gt;


---

# Estimativa de Efeitos Fixos no `R`
## use um Pacote!


* Na vida real, voc√™ dificilmente realizar√° a transforma√ß√£o intragrupo manualmente

* use um pacote!

* Existem v√°rias op√ß√µes ([`fixest`](https://github.com/lrberge/fixest) √© o mais eficiente). Em nosso contexto:


```r
mod$FE &lt;- fixest::feols(crmrte ~ prbarr | county, cdata)
```

* Observe a configura√ß√£o semelhante √† `estimatr::iv_robust` *f√≥rmula de duas partes*. Aqui os efeitos fixos v√™m ap√≥s o `|`.

* Al√©m disso, podemos ter *mais de um efeito fixo*! Para um exemplo legal com *tr√™s* efeitos fixos veja a [vinheta](https://cran.r-project.org/web/packages/fixest/vignettes/fixest_walkthrough.html) do pacote.

---

# Estimativa de Efeitos Fixos no `R`
## use o `fixest` üôÇ

.left-wide[
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-15">
<col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"> </th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">pooled</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">dummy</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">intra</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">FE</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.009</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.045</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.000</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.005)</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.005)</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.001)</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">prbarr</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.065</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><span style="color: rgb(255, 0, 0);">-0.028</span></td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><span style="color: rgb(255, 0, 0);"></span></td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><span style="color: rgb(255, 0, 0);">-0.028</span></td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.016)</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.014)</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.005)</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">demeaned_prob</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><span style="color: rgb(255, 0, 0);"></span></td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><span style="color: rgb(255, 0, 0);">-0.028</span></td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><span style="color: rgb(255, 0, 0);"></span></td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.013)</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">R2</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.390</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.893</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.159</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 0pt 1pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></td></tr>
</table>

]

.right-thin[

* Mesmas estimativas! üòÖ

* `fixest` calcula erros padr√£o **robustos por clusters**.

* Suspeita que haja forte correla√ß√£o nos res√≠duos *dentro* de cada condado (ao longo do tempo).

]


---

# Transforma√ß√£o Intragrupo Animada!

.left-wide[

&lt;img src="../../img/gifs/panel.gif" style="display: block; margin: auto;" /&gt;
]

.right-thin[

* Transforma√ß√£o intragrupo **centraliza** os dados!

* Subtrair a m√©dia temporal de `\(y\)` e `\(x\)`, *retira* os fatores fixos no tempo relacionados ao *condado*

* Apenas varia√ß√£o *dentro* do condado

* Cr√©ditos para [Nick C Huntington-Klein](http://nickchk.com).

]

---

# Leitura Recomendada

* WOOLDRIDGE, Jeffrey M. Introdu√ß√£o √† econometria: uma abordagem moderna. S√£o Paulo: Cengage Learning, 2016. Tradu√ß√£o da 4¬™ edi√ß√£o norte-americana por Jos√© Antonio Ferreira. Cap√≠tulo 13 O Agrupamento de Cortes Transversais ao Longo do Tempo.

* GUJARATI, Damodar N.; PORTER, Dawn C. Econometria b√°sica. Porto Alegre: Amgh Editora, 2011. - 5. ed. Cap√≠tulo 16 Modelos de regress√£o com dados em painel

---

layout: false

class: title-slide-final, middle
background-image: url(../../img/logo/UdescEsag.jpeg)
background-size: 350px
background-position: 9% 19%

# AT√â A PR√ìXIMA AULA!

Com a Lista 1 feita! ‚úÖ

.footnote[
[1]: Este slides foram baseados nas aulas de econometria da [SciencesPo Department of Economics](https://github.com/ScPoEcon/ScPoEconometrics-Slides)
]


|                                                                                                            |                                   |
| :--------------------------------------------------------------------------------------------------------- | :-------------------------------- |
| &lt;a href="https://github.com/rfbressan/econometria3_slides"&gt;.ScPored[&lt;i class="fa fa-link fa-fw"&gt;&lt;/i&gt;] | Slides |
| &lt;a href="http://github.com/rfbressan"&gt;.ScPored[&lt;i class="fa fa-github fa-fw"&gt;&lt;/i&gt;]                          | @rfbressan                      |
| &lt;a href="https://raw.githack.com/rfbressan/econometria3_slides/master/lectures/06-panel/lista_IV_pt.html"&gt;.ScPored[&lt;i class="fa fa-list fa-fw"&gt;&lt;/i&gt;] | Lista de Exerc√≠cios IV |

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="../../js/ru_xaringan.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
